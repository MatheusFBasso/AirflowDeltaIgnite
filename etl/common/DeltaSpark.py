from pyspark.sql import SparkSession
from .utils import Now

class DeltaSpark(Now):

    _SHOW = True

    ####################################################################################################################
    def __init__(self, app_name: str = 'PySparkDelta'):
        super().__init__()
        self._appName = app_name

    ####################################################################################################################
    def initialize(self):

        self.log_message(show=self._SHOW, start=True, sep='=', message='STARTING SPARK')

        # --------------------------------------------------------------------------------------------------------------
        spark = SparkSession.builder \
            .appName(self._appName) \
            .config("spark.eventLog.enabled", "false") \
            .config("spark.sql.extensions", "io.delta.sql.DeltaSparkSessionExtension") \
            .config("spark.sql.catalog.spark_catalog", "org.apache.spark.sql.delta.catalog.DeltaCatalog") \
            .config("spark.submit.deployMode", "client") \
            .getOrCreate()
        # --------------------------------------------------------------------------------------------------------------
        delta_version_info = f''.ljust(20, ' ')
        pyspark_version_info = f''.ljust(20, ' ')
        # --------------------------------------------------------------------------------------------------------------
        print(f"┌{'─' * 118}┐")
        print(r"│ _____/\\\\\\\\\\\____/\\\\\\\\\\\\\_______/\\\\\\\\\_______/\\\\\\\\\______/\\\________/\\\_______________________" + f"{' ' * 3}│")
        print(r"│ ____/\\\/////////\\\_\/\\\/////////\\\___/\\\\\\\\\\\\\___/\\\///////\\\___\/\\\_____/\\\//_______________________" + f"{' ' * 3}│")
        print(r"│ ____\//\\\______\///__\/\\\_______\/\\\__/\\\/////////\\\_\/\\\_____\/\\\___\/\\\__/\\\//_________________________" + f"{' ' * 3}│")
        print(r"│ ______\////\\\_________\/\\\\\\\\\\\\\/__\/\\\_______\/\\\_\/\\\\\\\\\\\/____\/\\\\\\//\\\________________________" + f"{' ' * 3}│")
        print(r"│ __________\////\\\______\/\\\/////////____\/\\\\\\\\\\\\\\\_\/\\\//////\\\____\/\\\//_\//\\\______________________" + f"{' ' * 3}│")
        print(r"│ ______________\////\\\___\/\\\_____________\/\\\/////////\\\_\/\\\____\//\\\___\/\\\____\//\\\____________________" + f"{' ' * 3}│")
        print(r"│ ________/\\\______\//\\\__\/\\\_____________\/\\\_______\/\\\_\/\\\_____\//\\\__\/\\\_____\//\\\____............__" + f"{' ' * 3}│")
        print(r"│ ________\///\\\\\\\\\\\/___\/\\\_____________\/\\\_______\/\\\_\/\\\______\//\\\_\/\\\______\//\\\__............._" + f"{' ' * 3}│")
        print(r"│ ___________\///////////_____\///______________\///________\///__\///________\///__\///________\///__............._" + f"{' ' * 3}│")
        print(r"│                                                             ........      '.....................................  " + f"{' ' * 3}│")
        print(r"│                                                            .........        ...................................   " + f"{' ' * 3}│")
        print(r"│                                                            .........         ..................   ...........     " + f"{' ' * 3}│")
        print(r"│                                                       .............           '........         ...........       " + f"{' ' * 3}│")
        print(r"│                                                ....................                           ...........         " + f"{' ' * 3}│")
        print(r"│                                         ...........................                         ...........           " + f"{' ' * 3}│")
        print(r"│                                     ............................                          ............            " + f"{' ' * 3}│")
        print(r"│                                   .......................                               ............              " + f"{' ' * 3}│")
        print(r"│                                  .................                                    ............                " + f"{' ' * 3}│")
        print(r"│                                  ...................                                  ...........                 " + f"{' ' * 3}│")
        print(r"│                                   ........................                             ...........                " + f"{' ' * 3}│")
        print(r"│                                     '..........................                         ...........               " + f"{' ' * 3}│")
        print(r"│__/\\\\\\\\\\\\____________________/\\\\\\________________________________________________.........._______________" + f"{' ' * 3}│")
        print(r"│__\/\\\////////\\\_________________\////\\\_________________________________________________.........._____________" + f"{' ' * 3}│")
        print(r"│___\/\\\______\//\\\___________________\/\\\________/\\\_____________________________________...........___________" + f"{' ' * 3}│")
        print(r"│____\/\\\_______\/\\\_____/\\\\\\\\_____\/\\\_____/\\\\\\\\\\\__/\\\\\\\\\_________......_____...........__________" + f"{' ' * 3}│")
        print(r"│_____\/\\\_______\/\\\___/\\\/////\\\____\/\\\____\////\\\////__\////////\\\_______....................... ________" + f"{' ' * 3}│")
        print(r"│______\/\\\_______\/\\\__/\\\\\\\\\\\_____\/\\\_______\/\\\________/\\\\\\\\\\_____........................________" + f"{' ' * 3}│")
        print(r"│_______\/\\\_______/\\\__\//\\///////______\/\\\_______\/\\\_/\\___/\\\/////\\\____........................________" + f"{' ' * 3}│")
        print(r"│________\/\\\\\\\\\\\\/____\//\\\\\\\\\\__/\\\\\\\\\____\//\\\\\___\//\\\\\\\\/\\__........................________" + f"{' ' * 3}│")
        print(r"│________\////////////_______\//////////__\/////////______\/////_____\////////\//________................. _________" + f"{' ' * 3}│")
        print(f"└{'─' * 118}┘")
        # --------------------------------------------------------------------------------------------------------------
        self.log_message(show=self._SHOW, end=True, sep='=', message='SPARK | DELTA | INITIALIZED')

        return spark